<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../../css/mui.min.css">
		<link rel="stylesheet" href="../../css/my_css.css">
		<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.2.0/css/bootstrap.min.css">
	</head>
	<body>
		<div class="mui-content">
			<div class="container">
				<div class="row">
					<div class="col-xs-12">
						<br />
						<div class="js-signature" style="" data-width="500" data-height="300" data-border="1px solid black"  data-auto-fit="true"></div>
						<div id="signature">
							<p>
								<em>手机签名中......</em>
							</p>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--底部-->
		<nav class="mui-bar mui-bar-tab ">
            <a class="mui-tab-item" href="#Popover_0">颜色</a>
            <a class="mui-tab-item" href="#Popover_1">粗细</a>
            <a class="mui-tab-item" id="Popover_2">撤销</a>
            <a class="mui-tab-item" id="Popover_3">清屏</a>
            <a class="mui-tab-item" id="Popover_4" disabled="disabled">提交</a>
        </nav>
        <!--颜色控制-->
        <div id="Popover_0" class="mui-popover mui-bar-popover">
            <div class="mui-popover-arrow"></div>
            <ul class="mui-table-view">
                <form id="group">
                    <li class="mui-table-view-cell mui-active" data-line-color="#000000"><a href="#"><div><label>黑</label><div style="float: right;background-color: #000000;width: 20px;height: 20px;"></div></div></a></li>
                    <li class="mui-table-view-cell" data-line-color="#FF0000"><a href="#"><div><label>红</label><div style="float: right;background-color: #FF0000;width: 20px;height: 20px;"></div></div></a></li>
                    <li class="mui-table-view-cell" data-line-color="#0000FF"><a href="#"><div><label>蓝</label><div style="float: right;background-color: #0000FF;width: 20px;height: 20px;"></div></div></a></li>
                    <li class="mui-table-view-cell" data-line-color="#00FF00"><a href="#"><div><label>绿</label><div style="float: right;background-color: #00FF00;width: 20px;height: 20px;"></div></div></a></li>
                </form>
            </ul>
        </div>
        <!--粗细控制-->
        <div id="Popover_1" class="mui-popover mui-bar-popover">
            <div class="mui-popover-arrow"></div>
            <ul class="mui-table-view">
                <form id="group1">
                    <li class="mui-table-view-cell mui-active" data-line-width="1"><a href="#"><div><label>1</label><div class="signIn-width" style="float: right;"></div></div></a></li>
                    <li class="mui-table-view-cell" data-line-width="3"><a href="#"><div><label>3</label><div class="signIn-width" style="float: right;"></div></div></a></li>
                    <li class="mui-table-view-cell" data-line-width="5"><a href="#"><div><label>5</label><div class="signIn-width" style="float: right;"></div></div></a></li>
                    <li class="mui-table-view-cell" data-line-width="7"><a href="#"><div><label>7</label><div class="signIn-width" style="float: right;"></div></div></a></li>
                    <li class="mui-table-view-cell" data-line-width="9"><a href="#"><div><label>9</label><div class="signIn-width" style="float: right;"></div></div></a></li>
                </form>
            </ul>
        </div>
	</body>
	<script src="../../js/mui.min.js"></script>
	<script src="../../js/jquery-1.11.0.min.js"></script>
	<script src="../../js/signature/jq-signature.min.js"></script>
	<script type="text/javascript">
		mui.init({
		    release:true//默认为false，不监听
		});
		//区域滚动,需手动初始化scroll控件
		mui('.mui-scroll-wrapper').scroll({
			deceleration: 0.0005 //flick 减速系数，系数越大，滚动速度越慢，滚动距离越小，默认值0.0006
		});		
		//设置线条属性
        lineColor = $('#Popover_0 .mui-active').data('line-color');
        lineWidth = $('#Popover_1 .mui-active').data('line-width');
        //定义图片变量
    	var imgData = [];
    	var i=0;
        
		mui.plusReady(function() {
            //签名保存
            $('#signIng').on('change',function(){
                alert('ok');
            });
            //选择画笔颜色
            $('#Popover_0 .mui-table-view-cell').on('tap',function(e) {
                $('#Popover_0 .mui-active').removeClass("mui-active");
                $(this).addClass("mui-active");
                lineColor = $('#Popover_0 .mui-active').data('line-color');
            });
            //选择画笔粗细
            $('#Popover_1 .mui-table-view-cell').on('tap',function(e) {
                $('#Popover_1 .mui-active').removeClass("mui-active");
                $(this).addClass("mui-active");
                lineWidth = $('#Popover_1 .mui-active').data('line-width');
            })
            
            //点击撤销
                //检测画布改变
            $('.js-signature').eq(0).on('jq.signature.changed', function() {
                canvas_copy();
            });
                //点击撤销按钮
            $('#Popover_2').on('tap',function (){
//              alert('ok');
                canvas_paste();
                $('#signature').html($('<p>').text('撤销成功'));
            });
            
            //执行清屏
            $('#Popover_3').on('tap',function (){
                $('.js-signature').eq(0).jqSignature('clearCanvas');
                $('#signature').html('<p><em>已执行清屏操作</em></p>');
            });
            
			//签名保存
			$('#Popover_4').on('tap',function(){
				$('#signature').html('<p><em>签名正在保存，请稍后</em></p>');
				var dataUrl = $('.js-signature').eq(0).jqSignature('getDataURL');
				var img = $('<img>').attr('src', dataUrl);
				$('#signature').html($('<p>').text('您的签名已经成功提交'));
				$('#signature').append(img);
			});
			
			if ($('.js-signature').length) {
				$('.js-signature').jqSignature();
			}
			
		});
    	//保存上一步图像
        function canvas_copy(){
            var c = document.getElementsByTagName("canvas");
            var context = c[0].getContext('2d');
            var width = context.canvas.width;
            var height = context.canvas.height;
            i++;
            imgData[i] = context.getImageData(0, 0, width, height);
        }
        //将土巷仔画布呈现
        function canvas_paste(){
            i--;
            if(i>0){
                var c = document.getElementsByTagName("canvas");
                var context = c[0].getContext('2d');
                context.putImageData(imgData[i],0,0);
                return;
            }
        }
	</script>
</html>